package com.springmvc.controller;

import java.util.List;

import javax.servlet.http.HttpServletRequest;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.PutMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;

import com.springmvc.domain.Lesson;
import com.springmvc.domain.LessonRegistration;
import com.springmvc.repository.OrderRepositoryImpl;
import com.springmvc.service.CoachService;
import com.springmvc.service.LessonRegistService;
import com.springmvc.service.LessonService;

@Controller
@RequestMapping("/lesson")
public class LessonRegistrationController 
{
	@Autowired 
	LessonService lessonService;
	

	@Autowired 
	LessonRegistService lessonRegistService;
	
	// 수강 신청 (C)
	@GetMapping("/regist") 
	public String requestRegistForm(@ModelAttribute("registration")LessonRegistration regist, @RequestParam String lessonId, Model model, HttpServletRequest request) // 파라미터는 
	{
		String memberId = request.getSession().getId();
		Lesson lesson= lessonService.readClassById(lessonId);
		model.addAttribute("ls",lesson);
		model.addAttribute("id",memberId);
		return "/Lesson/LessonRegistForm"; // 수강 신청 form 페이지 리턴
	}
	
	@PostMapping("/regist")
	public String confirmRegistForm(@ModelAttribute("registration")LessonRegistration regist, Model model) 
	{
		System.out.println("레쓰나 : "+ regist.getLessonId());
		String registDate = OrderRepositoryImpl.getTimeNow();
		regist.setRegistDate(registDate);
		
		model.addAttribute("regist",regist);
		return "/Lesson/RegistrationConfirm";
	}

	@PostMapping("/confirm")
	public String submitRegistForm(@ModelAttribute("registration")LessonRegistration regist, Model model) 
	{
		System.out.println("풋쓰나 : "+ regist.getLessonId());
		lessonRegistService.setNewLessonRegist(regist);
		return "/Lesson/Thanks";
		
	}
	
	@GetMapping("/myRegist")
	public String readMyLessonRegistration(Model model, HttpServletRequest req) 
	{
		String sessionId = req.getSession().getId();
		List<LessonRegistration> listOfRegistration = lessonRegistService.readAllLessonRegist(sessionId);
		
		model.addAttribute("list",listOfRegistration);
		return "/Lesson/RegistrationList";
	}
	
	@GetMapping("/{registrationId}")
	public String readLessonById(@PathVariable String registrationId,Model model) 
	{
		System.out.println("수강신청번호"+registrationId);
		LessonRegistration LR = lessonRegistService.readLessonRegistById(registrationId);
		model.addAttribute("regist",LR);
		return "/Lesson/MyLessonRegist";
	}
	//수강 목록 보기(R)
	
	//수강 결제 관리 (U) 
	
	// 수강 신청 취소 (D) -- 신청 검토 기능 필요
	
}
